package vex

import "time"

type Vex struct {
	Document Document `json:"document"`
	ProductTree ProductTree `json:"product_tree"`
	Vulnerabilities []Vulnerability `json:"vulnerabilities"`
}

func (v *Vex) GetCveById(id string) Vulnerability {
	if id == "" {
		return Vulnerability{}
	}
	for _, c := range v.Vulnerabilities {
		if c.Cve == id {
			return c
		}
	}
	return Vulnerability{}
}

func (v *Vex) GetProductById(id string) Product {
	if id == "" {
		return Product{}
	}
	for _, b := range v.ProductTree.Branches {
		if b.Product.ProductId == id {
			return b.Product
		}
		if len(b.Branches) > 0 {
			return v.GetProductById(id)
		}
	}
	return Product{}
}

type Document struct {
	Category    string `json:"category"`
	CsafVersion string `json:"csaf_version"`
	Notes []Note `json:"notes"`
	Publisher Publisher `json:"publisher"`
	Title string `json:"title"`
	Tracking Tracking `json:"tracking"`
}

type Note struct {
	Category string `json:"category"`
	Text     string `json:"text"`
	Title    string `json:"title"`
}

type Generator struct {
	Date time.Time `json:"date"`
	Engine Engine
}

type Engine struct {
	Name string `json:"name"`
	Version string `json:"version"`
}

type Revision struct {
	Date    time.Time `json:"date"`
	Number  string `json:"number"`
	Summary string `json:"summary"`
}

type Tracking struct {
	CurrentReleaseDate time.Time  `json:"current_release_date"`
	Generator          Generator  `json:"generator"`
	ID                 string     `json:"id"`
	InitialReleaseDate time.Time  `json:"initial_release_date"`
	RevisionHistory    []Revision `json:"revision_history"`
	Status             string     `json:"status"`
	Version            string     `json:"version"`
}

type Publisher struct {
	Category  string `json:"category"`
	Name      string `json:"name"`
	Namespace string `json:"namespace"`
}

type ProductTree struct {
	Branches []ProductBranch `json:"branches,omitempty"`
}

type ProductBranch struct {
	Category string `json:"category,omitempty"`
	Name string `json:"name,omitempty"`
	Product Product `json:"product,omitempty"`
	Branches []ProductBranch `json:"branches,omitempty"`
}

type Product struct {
	Name      string `json:"name,omitempty"`
	ProductId string `json:"product_id,omitempty"`
}

type Vulnerability struct {
	Cve string `json:"cve"`
	Notes []Note `json:"notes,omitempty"`
	ProductStatus ProductStatus `json:"product_status"`
	References []Reference `json:"references"`
	Remediations []Remediation `json:"remediations"`
	Threats []Threat `json:"threats,,omitempty"`
}

type ProductStatus struct {
	Fixed            []string `json:"fixed,omitempty"`
	KnownAffected    []string `json:"known_affected,omitempty"`
	KnownNotAffected []string `json:"known_not_affected,omitempty"`
	Recommended      []string `json:"recommended,omitempty"`
}

type Threat struct {
	Category   string   `json:"category"`
	Details    string   `json:"details"`
	ProductIds []string `json:"product_ids"`
}

type Reference struct {
	Category string `json:"category"`
	Summary  string `json:"summary"`
	URL      string `json:"url"`
}

type Remediation struct {
	Category   string   `json:"category"`
	Details    string   `json:"details"`
	ProductIds []string `json:"product_ids"`
}

type Scores struct {
	CvssV3 `json:"cvss_v3,omitempty"`
	Products []string
}

type CvssV3 struct {
	AttackComplexity      string `json:"attackComplexity"`
	AttackVector          string `json:"attackVector"`
	AvailabilityImpact    string `json:"availabilityImpact"`
	BaseScore             int    `json:"baseScore"`
	BaseSeverity          string `json:"baseSeverity"`
	ConfidentialityImpact string `json:"confidentialityImpact"`
	IntegrityImpact       string `json:"integrityImpact"`
	PrivilegesRequired    string `json:"privilegesRequired"`
	Scope                 string `json:"scope"`
	UserInteraction       string `json:"userInteraction"`
	VectorString          string `json:"vectorString"`
	Version               string `json:"version"`
}

