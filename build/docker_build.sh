set -x
set -o errexit
set -o nounset
set -o pipefail

while getopts v: flag
do
    case "${flag}" in
        v) imageVersion=$OPTARG;;
        *) exit 1;;
    esac
done

SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

(cd "$SCRIPT_DIR/.." && make build-cross-platform)

cp "$SCRIPT_DIR/../bin/linux/amd64/vulnerabilityProcessor" "$SCRIPT_DIR"

docker build -t "vulnerabilityprocessor/linux:$imageVersion" "$SCRIPT_DIR/."

rm "$SCRIPT_DIR/vulnerabilityProcessor"
